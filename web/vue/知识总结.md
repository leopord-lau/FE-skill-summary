# vue知识

## 组件通信的六种方式
### 一、 `props` / `$emit`

1. 父组件 -> 子组件

父组件
```html
  <Son :name = "name" />
```
子组件
```html
<template>
  <h1>{{name}}</h1>
</template>

<script>
export default {
  props: {
    name: {
      type: String,
      required: true
    }
  }
}
</script>
```

2. 子组件 -> 父组件

父组件
```html
<template>
  <div id="app">
    <Son :name="named" @updateName="updateName"></Son>
  </div>
</template>

<script>
import Son from './son.vue'

export default {
  name: 'App',
  data() {
    return {
      named: "leo"
    }
  },
  components: {
    Son
  },
  methods: {
    updateName(name) {
      this.named = name
    }
  }
}
</script>
```

子组件
```html
<template>
  <h1 @click="changeName">{{name}}</h1>
</template>

<script>
export default {
  props: {
    name: {
      type: String,
      required: true
    }
  },
  methods: {
    changeName() {
      this.$emit("updateName", "子组件向父组件传值")
    }
  }
}
</script>
```

### 二、 `$emit` / `$on`

这种方法通过一个空的`Vue`实例作为中央事件总线（事件中心），用它来触发事件和监听事件,巧妙而轻量地实现了任何组件间的通信，包括父子、兄弟、跨级。

为了方便将`Bus`（空`vue`）定义在一个组件中，在实际的运用中一般会新建一个`Bus.js`
```js
import Vue from 'vue'
const Bus = new Vue()
export default Bus
```

组件1：
```js
import Bus from './Bus'

export default {
    data() {
        return {
            .........
            }
      },
  methods: {
        ....
        Bus.$emit('updateName', 'leo')
    },

  }
```

组件2：
```js
import Bus from './Bus'

export default {
    data() {
        return {
            .........
            }
      },
    mounted () {
       Bus.$on('updateName', content => { 
          console.log(content)
        });    
    }    
}
```


当然也可以直接将Bus注入到Vue根对象中。

```js
new Vue({
  render: h => h(App),
  data: {
    Bus: new Vue()
  }
}).$mount('#app')
```
在子组件中通过`this.$root.Bus.$on()`,`this.$root.Bus.$emit()`来调用。

将`bus`挂载到`vue.prototype`上。
```js
// plugin/index.js
import Bus from 'vue';
let install = function (Vue) {
    ... ...
    // 设置eventBus
    Vue.prototype.bus = new Bus();
    ... ...
}

export default {install};

// main.js
import Vue from 'vue';
import plugin from './plugin/index';

Vue.use(plugin);
```

组件一中定义

```js
created () {
  this.bus.$on('updateData', this.getdata);
}
```
组件二中调用
```js
this.bus.$emit('updateData', {loading: false});
```
注意：注册的总线事件要在组件销毁时卸载，否则会多次挂载，造成触发一次但多个响应的情况
```js
beforeDestroy () {
  this.bus.$off('updateData', this.getData);
}
```